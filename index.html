<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—É—Å—Å–∫–æ–µ –õ–æ—Ç–æ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            background-color: #f7f7f7;
        }
        h1 {
            margin-top: 20px;
            font-size: 24px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 300px;
        }
        .cell {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            border: 1px solid #ddd;
            font-size: 18px;
            font-weight: bold;
        }
        .cell.marked {
            background-color: #4caf50;
            color: #fff;
        }
        .number-draw {
            margin: 20px 0;
            font-size: 18px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #005f99;
        }
    </style>
</head>
<body>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –†—É—Å—Å–∫–æ–µ –õ–æ—Ç–æ!</h1>
    <p id="user-info"></p>
    <div class="grid" id="ticket"></div>
    <div class="number-draw" id="drawn-number"></div>
    <button id="start-game">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    <button id="draw-number" style="display:none;">üé≤ –í—ã—Ç—è–Ω—É—Ç—å —á–∏—Å–ª–æ</button>
    <script>
        const tg = window.Telegram.WebApp;
        const ticketGrid = document.getElementById("ticket");
        const drawnNumber = document.getElementById("drawn-number");
        const startButton = document.getElementById("start-game");
        const drawButton = document.getElementById("draw-number");

        let ticketNumbers = [];
        let drawnNumbers = [];

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
        document.getElementById('user-info').innerText = 
            `–ü—Ä–∏–≤–µ—Ç, ${tg.initDataUnsafe.user.first_name || '–ò–≥—Ä–æ–∫'}!`;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞
        function generateTicket() {
            const numbers = Array.from({ length: 90 }, (_, i) => i + 1);
            ticketNumbers = [];
            while (ticketNumbers.length < 15) {
                const index = Math.floor(Math.random() * numbers.length);
                ticketNumbers.push(numbers.splice(index, 1)[0]);
            }
            ticketNumbers.sort((a, b) => a - b);
            renderTicket();
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∏–ª–µ—Ç–∞
        function renderTicket() {
            ticketGrid.innerHTML = "";
            ticketNumbers.forEach((number, index) => {
                const cell = document.createElement("div");
                cell.className = "cell";
                cell.innerText = number;
                ticketGrid.appendChild(cell);
            });
        }

        // –í—ã—Ç—è–≥–∏–≤–∞–Ω–∏–µ —á–∏—Å–ª–∞
        function drawNumber() {
            const numbers = Array.from({ length: 90 }, (_, i) => i + 1).filter(n => !drawnNumbers.includes(n));
            if (numbers.length === 0) {
                drawnNumber.innerText = "–í—Å–µ —á–∏—Å–ª–∞ –≤—ã—Ç—è–Ω—É—Ç—ã!";
                drawButton.style.display = "none";
                return;
            }
            const index = Math.floor(Math.random() * numbers.length);
            const number = numbers[index];
            drawnNumbers.push(number);
            drawnNumber.innerText = `–í—ã–ø–∞–ª–æ —á–∏—Å–ª–æ: ${number}`;
            markNumber(number);
        }

        // –ü–æ–º–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
        function markNumber(number) {
            const cells = document.querySelectorAll(".cell");
            cells.forEach(cell => {
                if (parseInt(cell.innerText) === number) {
                    cell.classList.add("marked");
                }
            });
            if (ticketNumbers.every(n => drawnNumbers.includes(n))) {
                drawnNumber.innerText = "üèÜ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!";
                drawButton.style.display = "none";
            }
        }

        // –°–æ–±—ã—Ç–∏—è –∫–Ω–æ–ø–æ–∫
        startButton.onclick = () => {
            generateTicket();
            drawnNumbers = [];
            drawnNumber.innerText = "";
            startButton.style.display = "none";
            drawButton.style.display = "inline-block";
        };
        drawButton.onclick = drawNumber;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Web App
        tg.MainButton.text = "–ó–∞–∫—Ä—ã—Ç—å";
        tg.MainButton.show();
        tg.MainButton.onClick(() => tg.close());
    </script>
</body>
</html>
